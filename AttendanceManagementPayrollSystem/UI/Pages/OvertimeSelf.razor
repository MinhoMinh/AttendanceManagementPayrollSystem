@page "/overtime/self"
@using System.Net.Http.Json
@using AttendanceManagementPayrollSystem.DTO
@using System.Text.Json
@using AttendanceManagementPayrollSystem.Models
@inject IJSRuntime JS
@inject IHttpClientFactory HttpFactory

<div class="overtime-container">
    <!-- Header Section -->
    <div class="page-header">
        <h4 class="page-title">
            <i class="bi bi-clock-history me-2"></i>
            Quản lý tăng ca của tôi
        </h4>
    </div>

    <div class="content-wrapper">
        <!-- Trái -->
        <div class="left-section">
            <!-- Filter Card -->
            <Card Class="filter-card">
                <CardBody>
                    <div class="filter-header">
                        <div class="filter-icon">
                            <i class="bi bi-funnel"></i>
                        </div>
                        <span class="filter-title">Bộ lọc</span>
                    </div>

                    <div class="date-filters">
                        <div class="date-input-group">
                            <label class="custom-label">
                                <i class="bi bi-calendar-event me-1"></i>
                                Từ ngày
                            </label>
                            <DatePicker TValue="DateOnly?" Date="fromDate" DateChanged="LoadData" />
                        </div>

                        <div class="date-separator">
                            <i class="bi bi-arrow-right"></i>
                        </div>

                        <div class="date-input-group">
                            <label class="custom-label">
                                <i class="bi bi-calendar-check me-1"></i>
                                Đến ngày
                            </label>
                            <DatePicker TValue="DateOnly?" Date="toDate" DateChanged="LoadData" />
                        </div>
                    </div>

                    <Button Color="Color.Primary" Class="add-button" @onclick="ShowAddModal">
                        <i class="bi bi-plus-circle me-2"></i>
                        Thêm yêu cầu mới
                    </Button>
                </CardBody>
            </Card>

            <!-- Table Card -->
            <Card Class="table-card">
                <CardBody>
                    <div class="table-header">
                        <h6 class="table-title">
                            <i class="bi bi-list-ul me-2"></i>
                            Danh sách yêu cầu
                        </h6>
                        @if (requests != null)
                        {
                            <span class="badge-count">@requests.Count yêu cầu</span>
                        }
                    </div>

                    @if (requests == null)
                    {
                        <div class="loading-state">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Đang tải dữ liệu...</p>
                        </div>
                    }
                    else if (requests.Count == 0)
                    {
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <p>Chưa có yêu cầu nào</p>
                        </div>
                    }
                    else
                    {
                        <div class="custom-table">
                            <Table Hoverable="true" Class="data-table">
                                <TableHeader>
                                    <TableRow>
                                        <TableHeaderCell>
                                            <i class="bi bi-calendar3 me-1"></i>
                                            Ngày
                                        </TableHeaderCell>
                                        <TableHeaderCell>
                                            <i class="bi bi-clock me-1"></i>
                                            Giờ
                                        </TableHeaderCell>
                                        <TableHeaderCell>
                                            <i class="bi bi-info-circle me-1"></i>
                                            Trạng thái
                                        </TableHeaderCell>
                                    </TableRow>
                                </TableHeader>
                                <TableBody>
                                    @foreach (var item in requests)
                                    {
                                        <TableRow @onclick="() => Select(item)" Class="@(selected?.ReqDate == item.ReqDate && selected?.StartTime == item.StartTime ? "selected-row" : "")">
                                            <TableRowCell>
                                                <strong>@item.ReqDate</strong>
                                            </TableRowCell>
                                            <TableRowCell>
                                                <span class="badge-hours">@item.Hours h</span>
                                            </TableRowCell>
                                            <TableRowCell>
                                                <span class="status-badge status-@item.Status.ToLower()">
                                                    @item.Status
                                                </span>
                                            </TableRowCell>
                                        </TableRow>
                                    }
                                </TableBody>
                            </Table>
                        </div>
                    }
                </CardBody>
            </Card>
        </div>

        <!-- Phải -->
        <div class="right-section">
            @if (selected != null)
            {
                <Card Class="detail-card">
                    <CardBody>
                        <div class="detail-header">
                            <h6 class="detail-title">
                                <i class="bi bi-file-text me-2"></i>
                                Chi tiết yêu cầu
                            </h6>
                            <span class="status-badge status-@selected.Status.ToLower()">
                                @selected.Status
                            </span>
                        </div>

                        <div class="detail-content">
                            <div class="detail-group">
                                <div class="detail-item">
                                    <div class="detail-icon">
                                        <i class="bi bi-calendar-event"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Ngày</span>
                                        <span class="detail-value">@selected.ReqDate</span>
                                    </div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-icon">
                                        <i class="bi bi-clock"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Thời gian</span>
                                        <span class="detail-value">@selected.StartTime - @selected.EndTime</span>
                                    </div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-icon">
                                        <i class="bi bi-hourglass-split"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Tổng giờ</span>
                                        <span class="detail-value highlight">@selected.Hours giờ</span>
                                    </div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-icon">
                                        <i class="bi bi-tag"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Loại tăng ca</span>
                                        <span class="detail-value">@selected.OvertimeTypeName</span>
                                    </div>
                                </div>
                            </div>

                            <div class="divider"></div>

                            <div class="detail-group">
                                <div class="detail-item full-width">
                                    <div class="detail-icon">
                                        <i class="bi bi-chat-left-text"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Lý do</span>
                                        <span class="detail-value">@selected.Reason</span>
                                    </div>
                                </div>

                                <div class="detail-item full-width">
                                    <div class="detail-icon">
                                        <i class="bi bi-person-check"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Duyệt bởi</span>
                                        <span class="detail-value">@(selected.ApprovedByName ?? "Chưa duyệt")</span>
                                    </div>
                                </div>

                                <div class="detail-item full-width">
                                    <div class="detail-icon">
                                        <i class="bi bi-calendar-check"></i>
                                    </div>
                                    <div class="detail-text">
                                        <span class="detail-label">Ngày duyệt</span>
                                        <span class="detail-value">@(selected.ApprovedDate?.ToString() ?? "Chưa duyệt")</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </CardBody>
                </Card>
            }
            else
            {
                <Card Class="detail-card empty">
                    <CardBody>
                        <div class="empty-detail-state">
                            <i class="bi bi-hand-index"></i>
                            <h6>Chọn một yêu cầu</h6>
                            <p>Nhấp vào một yêu cầu trong danh sách để xem chi tiết</p>
                        </div>
                    </CardBody>
                </Card>
            }
        </div>
    </div>
</div>

<Modal @bind-Visible="addVisible"
       Class="overtime-modal"
       Backdrop="Backdrop.Static">

    <ModalHeader>
        <i class="bi bi-plus-circle me-2"></i>
        Thêm yêu cầu tăng ca
    </ModalHeader>

    <ModalBody class="modal-body-custom">
        <div class="form-group-custom">
            <label class="form-label-custom">
                <i class="bi bi-calendar-event me-1"></i>
                Ngày làm thêm
            </label>
            <DatePicker @bind-Date="newReqDate" />
        </div>

        <div class="time-group">
            <div class="form-group-custom">
                <label class="form-label-custom">
                    <i class="bi bi-clock me-1"></i>
                    Giờ bắt đầu
                </label>
                <TimePicker TValue="TimeOnly?" @bind-Time="newStart" />
            </div>

            <div class="time-separator">
                <i class="bi bi-arrow-right"></i>
            </div>

            <div class="form-group-custom">
                <label class="form-label-custom">
                    <i class="bi bi-clock-fill me-1"></i>
                    Giờ kết thúc
                </label>
                <TimePicker TValue="TimeOnly?" @bind-Time="newEnd" />
            </div>
        </div>

        <div class="hours-display">
            <i class="bi bi-hourglass-split me-2"></i>
            <span>Tổng số giờ:</span>
            <strong>@hoursDisplay giờ</strong>
        </div>

        <div class="form-group-custom">
            <label class="form-label-custom">
                <i class="bi bi-tag me-1"></i>
                Loại tăng ca
            </label>
            <Select TValue="int?" @bind-SelectedValue="selectedTypeId">
                <SelectItem Value="@((int?)null)">-- Chọn loại tăng ca --</SelectItem>
                @foreach (var t in types)
                {
                    <SelectItem Value="t.Id">@t.OvertimeType</SelectItem>
                }
            </Select>
        </div>

        <div class="form-group-custom">
            <label class="form-label-custom">
                <i class="bi bi-chat-left-text me-1"></i>
                Lý do
            </label>
            <TextEdit @bind-Text="newReason" Rows="3" />
        </div>
    </ModalBody>

    <ModalFooter>
        <Button Color="Color.Primary" Class="btn-save" @onclick="Submit">
            <i class="bi bi-check-circle me-2"></i>
            Lưu yêu cầu
        </Button>
        <Button Color="Color.Secondary" Class="btn-cancel" @onclick="HideAddModal">
            <i class="bi bi-x-circle me-2"></i>
            Hủy
        </Button>
    </ModalFooter>

</Modal>

<style>
    /* Màu chính */
    :root {
        --primary-color: #97322D;
        --secondary-color: #FFE4A1;
        --accent-color: #C44741;
        --light-bg: #FFF9ED;
        --text-dark: #2C1810;
        --text-muted: #6C5649;
        --border-color: #E8D4B8;
        --success-color: #2E7D32;
        --warning-color: #F57C00;
        --danger-color: #C62828;
    }

    /* Container chính */
    .overtime-container {
        background: linear-gradient(135deg, #FFF9ED 0%, #FFEFD5 100%);
        min-height: 100vh;
        padding: 2rem;
    }

    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        padding: 1.5rem 2rem;
        border-radius: 16px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(151, 50, 45, 0.2);
    }

    .page-title {
        color: white;
        margin: 0;
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .content-wrapper {
        display: flex;
        gap: 2rem;
        width: 100%;
    }

    /* Left Section */
    .left-section {
        flex: 1.2;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .filter-card {
        border: 2px solid var(--secondary-color);
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        background: white;
    }

        .filter-card .card-body {
            padding: 1.5rem;
        }

    .filter-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.25rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--secondary-color);
    }

    .filter-icon {
        background: var(--secondary-color);
        color: var(--primary-color);
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .filter-title {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 1.1rem;
    }

    .date-filters {
        display: flex;
        align-items: end;
        gap: 1rem;
        margin-bottom: 1.25rem;
    }

    .date-input-group {
        flex: 1;
    }

    .date-separator {
        color: var(--primary-color);
        font-size: 1.5rem;
        padding-bottom: 0.5rem;
    }

    .custom-label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-dark);
        font-weight: 500;
        font-size: 0.9rem;
    }

    .add-button {
        background: var(--primary-color) !important;
        border: none !important;
        border-radius: 12px !important;
        padding: 0.75rem 1.5rem !important;
        font-weight: 600 !important;
        width: 100%;
        transition: all 0.3s ease !important;
        box-shadow: 0 4px 12px rgba(151, 50, 45, 0.3);
    }

        .add-button:hover {
            background: var(--accent-color) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(151, 50, 45, 0.4);
        }

    /* Table Card */
    .table-card {
        border: 2px solid var(--secondary-color);
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        background: white;
        flex: 1;
    }

        .table-card .card-body {
            padding: 1.5rem;
        }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--secondary-color);
    }

    .table-title {
        margin: 0;
        color: var(--text-dark);
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .badge-count {
        background: var(--secondary-color);
        color: var(--primary-color);
        padding: 0.35rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .custom-table {
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border-color);
    }

    .data-table thead {
        background: var(--secondary-color);
    }

        .data-table thead th {
            color: var(--primary-color);
            font-weight: 600;
            border: none;
            padding: 1rem;
        }

    .data-table tbody tr {
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid var(--border-color);
    }

        .data-table tbody tr:hover {
            background: var(--light-bg);
            transform: translateX(4px);
        }

        .data-table tbody tr.selected-row {
            background: linear-gradient(90deg, var(--secondary-color) 0%, transparent 100%);
            border-left: 4px solid var(--primary-color);
        }

    .data-table tbody td {
        padding: 1rem;
        vertical-align: middle;
    }

    .badge-hours {
        background: var(--light-bg);
        color: var(--primary-color);
        padding: 0.35rem 0.85rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        border: 1px solid var(--secondary-color);
    }

    .status-badge {
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
    }

    .status-pending {
        background: #FFF3CD;
        color: #856404;
        border: 1px solid #FFE69C;
    }

    .status-approved {
        background: #D4EDDA;
        color: #155724;
        border: 1px solid #C3E6CB;
    }

    .status-rejected {
        background: #F8D7DA;
        color: #721C24;
        border: 1px solid #F5C6CB;
    }

    .loading-state, .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-muted);
    }

        .empty-state i {
            font-size: 4rem;
            color: var(--border-color);
            margin-bottom: 1rem;
        }

    /* Right Section */
    .right-section {
        flex: 1;
    }

    .detail-card {
        border: 2px solid var(--secondary-color);
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        background: white;
        position: sticky;
        top: 2rem;
    }

        .detail-card .card-body {
            padding: 1.5rem;
        }

    .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--secondary-color);
    }

    .detail-title {
        margin: 0;
        color: var(--text-dark);
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .detail-content {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .detail-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .detail-item {
        display: flex;
        gap: 1rem;
        padding: 0.75rem;
        background: var(--light-bg);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }

        .detail-item:hover {
            background: var(--secondary-color);
            border-color: var(--primary-color);
        }

        .detail-item.full-width {
            width: 100%;
        }

    .detail-icon {
        background: white;
        color: var(--primary-color);
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
        border: 2px solid var(--secondary-color);
    }

    .detail-text {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        flex: 1;
    }

    .detail-label {
        font-size: 0.85rem;
        color: var(--text-muted);
        font-weight: 500;
    }

    .detail-value {
        color: var(--text-dark);
        font-weight: 600;
        font-size: 1rem;
    }

        .detail-value.highlight {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

    .divider {
        height: 2px;
        background: linear-gradient(90deg, transparent 0%, var(--secondary-color) 50%, transparent 100%);
        margin: 0.5rem 0;
    }

    .empty-detail-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-muted);
    }

        .empty-detail-state i {
            font-size: 5rem;
            color: var(--border-color);
            margin-bottom: 1.5rem;
        }

        .empty-detail-state h6 {
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

    /* Modal */
    .overtime-modal {
        max-width: 600px;
        margin: auto;
    }

        .overtime-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            padding: 1.5rem;
            font-weight: 600;
            border: none;
        }

    .modal-body-custom {
        background: var(--light-bg);
        padding: 2rem;
    }

    .form-group-custom {
        margin-bottom: 1.25rem;
    }

    .form-label-custom {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-dark);
        font-weight: 600;
        font-size: 0.95rem;
    }

    .time-group {
        display: flex;
        align-items: end;
        gap: 1rem;
        margin-bottom: 1.25rem;
    }

        .time-group .form-group-custom {
            flex: 1;
            margin-bottom: 0;
        }

    .time-separator {
        color: var(--primary-color);
        font-size: 1.5rem;
        padding-bottom: 0.5rem;
    }

    .hours-display {
        background: white;
        border: 2px solid var(--secondary-color);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 1.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-dark);
    }

        .hours-display i {
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .hours-display strong {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-left: auto;
        }

    .overtime-modal .modal-footer {
        background: white;
        border-top: 2px solid var(--secondary-color);
        padding: 1.25rem 2rem;
    }

    .btn-save {
        background: var(--primary-color) !important;
        border: none !important;
        border-radius: 10px !important;
        padding: 0.65rem 1.75rem !important;
        font-weight: 600 !important;
        transition: all 0.3s ease !important;
    }

        .btn-save:hover {
            background: var(--accent-color) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(151, 50, 45, 0.3);
        }

    .btn-cancel {
        border-radius: 10px !important;
        padding: 0.65rem 1.75rem !important;
        font-weight: 600 !important;
    }

    /* Responsive */
    @@media (max-width: 1200px) {
        .content-wrapper

    {
        flex-direction: column;
    }

    .right-section .detail-card {
        position: static;
    }

    }

    @@media (max-width: 768px) {
        .overtime-container

    {
        padding: 1rem;
    }

    .date-filters {
        flex-direction: column;
        align-items: stretch;
    }

    .date-separator {
        transform: rotate(90deg);
        padding: 0.5rem 0;
    }

    .time-group {
        flex-direction: column;
        align-items: stretch;
    }

    .time-separator {
        transform: rotate(90deg);
        padding: 0.5rem 0;
        align-self: center;
    }

    }
</style>


@code {
    EmployeeDTO Employee;
    DateOnly fromDate = DateOnly.FromDateTime(DateTime.Today.AddYears(-1));
    DateOnly toDate = DateOnly.FromDateTime(DateTime.Today);

    List<OvertimeRequestDTO> requests;
    List<OvertimeRateDTO> types = new();
    OvertimeRequestDTO selected;
    int? selectedTypeId;

    bool addVisible;
    DateOnly newReqDate;
    string newReason;
    TimeOnly? _newStart;
    TimeOnly? newStart
    {
        get => _newStart;
        set
        {
            _newStart = value;
            Recalc();
        }
    }
    TimeOnly? _newEnd;
    TimeOnly? newEnd
    {
        get => _newEnd;
        set
        {
            _newEnd = value;
            Recalc();
        }
    }

    void Recalc()
    {
        if (newStart.HasValue && newEnd.HasValue)
        {
            hours = (decimal)(newEnd.Value - newStart.Value).TotalHours;
            if (hours < 0) hours = null;
        }
        else hours = null;

    }


    [Inject] INotificationService NotificationService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var empJson = await JS.InvokeAsync<string>("localStorage.getItem", "employee");
            if (!string.IsNullOrWhiteSpace(empJson))
            {
                Employee = JsonSerializer.Deserialize<EmployeeDTO>(empJson);
                LoadData(null);
            }

            var client = HttpFactory.CreateClient("ApiClient");
            var response = await client.GetFromJsonAsync<IEnumerable<OvertimeRateDTO>>(
                $"api/overtime/rates");
            if (response == null)
            {
                NotificationService.Warning("Không tìm thấy dữ liệu loai tăng ca", "Lỗi");
            }
            else
            {
                types = response.ToList();
            }

        }
        catch
        {
            NotificationService.Warning("Không tìm thấy thông tin nhân viên", "Lỗi");
        }
    }

    async Task LoadData(DateOnly? _)
    {
        if (Employee == null)
        {
            NotificationService.Warning("Không tìm thấy thông tin nhân viên", "Lỗi");
            return;
        }

        var client = HttpFactory.CreateClient("ApiClient");
        var response = await client.GetFromJsonAsync<List<OvertimeRequestDTO>>(
            $"api/overtime/history?empId={Employee.EmpId}&startDate={fromDate}&endDate={toDate}");

        if (response == null)
        {
            NotificationService.Warning("Không tìm thấy dữ liệu tăng ca", "Lỗi");
            return;
        }

        requests = response;
        StateHasChanged();
    }

    void Select(OvertimeRequestDTO item) => selected = item;

    void ShowAddModal()
    {
        newReqDate = DateOnly.FromDateTime(DateTime.Today);
        addVisible = true;
    }
    void HideAddModal() => addVisible = false;

    async Task Submit()
    {
        if (hours == null)
        {
            NotificationService.Warning("Không thể tìm thấy giờ.", "Lỗi");
            return;
        }

        if (selectedTypeId == null)
        {
            NotificationService.Warning("Chua chon loai tang cuong.", "Lỗi");
            return;
        }

        if (Employee == null)
        {
            NotificationService.Warning("Không thể tìm thấy thong tin nhan vien.", "Lỗi");
            return;
        }

        var request = new OvertimeRequest
        {
            EmpId = Employee.EmpId,
            ReqDate = newReqDate,
            StartTime = newStart,
            EndTime = newEnd,
            Hours = hours,
            Reason = newReason,
            Status = "Pending",
            OvertimeType = selectedTypeId
        };

        var client = HttpFactory.CreateClient("ApiClient");
        var res = await client.PostAsJsonAsync("api/overtime/request", request);

        if (!res.IsSuccessStatusCode)
        {
            NotificationService.Warning("Gửi thất bại.", "Lỗi");
            return;
        }

        NotificationService.Success("Đã gửi");
        addVisible = false;
        await LoadData(null);
    }


    decimal? hours;
    string hoursDisplay => hours?.ToString("0.##") ?? "0";

}