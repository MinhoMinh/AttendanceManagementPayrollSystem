@using AttendanceManagementPayrollSystem.DTO
@using Blazorise
@using System.Globalization

@code {
    private static readonly CultureInfo viVn = new("vi-VN");

    [Parameter] public Dictionary<string, List<PayRunItemDto>>? Groups { get; set; }
    [Parameter] public EventCallback<PayRunItemDto> OnItemSelected { get; set; }

    private async Task SelectItem(PayRunItemDto item)
    {
        if (OnItemSelected.HasDelegate)
            await OnItemSelected.InvokeAsync(item);
    }
}

@if (Groups == null || Groups.Count == 0)
{
    <p>Không có mục bảng lương.</p>
}
else
{
    @foreach (var grp in Groups)
    {
        <Card class="mb-3">
            <CardHeader>
                <strong>@grp.Key</strong>
            </CardHeader>

            <CardBody>
                <table class="table table-bordered table-sm">
                    <thead>
                        <tr>
                            <th>Nhân viên</th>
                            <th>Lương gộp</th>
                            <th>Khấu trừ</th>
                            <th>Lương thực nhận</th>
                            <th>Ghi chú</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in grp.Value)
                        {
                            <tr style="cursor:pointer" @onclick="@(() => SelectItem(item))">
                                <td>@item.EmpName</td>
                                <td>@item.GrossPay.ToString("C0", viVn)</td>
                                <td>@item.Deductions.ToString("C0", viVn)</td>
                                <td>@item.NetPay.ToString("C0", viVn)</td>
                                <td>@item.Notes</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </CardBody>
        </Card>
    }
}
