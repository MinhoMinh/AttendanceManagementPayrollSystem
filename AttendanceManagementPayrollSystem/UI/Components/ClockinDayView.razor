@using AttendanceManagementPayrollSystem.DTO
@using Blazorise

<Card Class="mb-3 shadow-sm">
    <CardHeader class="d-flex justify-content-between align-items-center">
        <strong>Ca làm</strong>
        <button class="btn btn-warning btn-sm" @onclick="ReportThisAsync">
            Báo cáo
        </button>
    </CardHeader>

    <CardBody>
        <Field>
            <FieldLabel>Tình trạng</FieldLabel>
            <FieldBody>
                @if (!string.IsNullOrWhiteSpace(Component.Description))
                {
                    bool isFull = Component.Description.Trim() == "Đủ giờ";
                    <Badge Color="@(isFull ? Color.Success : Color.Danger)">
                        @Component.Description
                    </Badge>
                }
                else
                {
                    <Badge Color="Color.Secondary">Không có dữ liệu</Badge>
                }
            </FieldBody>
        </Field>

        <Field>
            <FieldLabel>Giờ làm</FieldLabel>
            <FieldBody>
                @($"{(Component.WorkHours ?? 0m):F2}/{(Component.ScheduledHours ?? 0m):F2}")
            </FieldBody>
        </Field>

        @if (Component.OverridedWorkunits is not null)
        {
            <Field>
                <FieldLabel>Công làm (đã điều chỉnh)</FieldLabel>
                <FieldBody>
                    <span>
                        <span class="fw-bold text-warning">
                            @($"{Component.OverridedWorkunits:F2}")
                        </span>
                        <span class="text-muted">
                            (@($"{(Component.WorkUnits ?? 0m):F2}"))
                        </span>
                        /@($"{(Component.ScheduledUnits ?? 0m):F2}")
                    </span>
                </FieldBody>
            </Field>
        }
        else
        {
            <Field>
                <FieldLabel>Công làm</FieldLabel>
                <FieldBody>
                    <span class="fw-bold text-primary">
                        @($"{(Component.WorkUnits ?? 0m):F2}/{(Component.ScheduledUnits ?? 0m):F2}")
                    </span>
                </FieldBody>
            </Field>
        }
        <Field>
            <FieldLabel>Giờ vào / Giờ ra</FieldLabel>
            <FieldBody>
                <div class="d-flex flex-row gap-3">
                    <span>@(Component.CheckIn?.ToString("HH:mm") ?? "--:--")</span>
                    <span>@(Component.CheckOut?.ToString("HH:mm") ?? "--:--")</span>
                </div>
            </FieldBody>
        </Field>

        <Field>
            <FieldLabel>Bảng ghi</FieldLabel>
            <FieldBody>
                @if (!string.IsNullOrWhiteSpace(Component.ClockinLog))
                {
                    <pre class="mb-0">@Component.ClockinLog</pre>
                }
                else
                {
                    <span>Không có dữ liệu</span>
                }
            </FieldBody>
        </Field>
    </CardBody>
</Card>

@code {
    [Parameter] public ClockinComponentDto Component { get; set; }
    [Parameter] public EventCallback<ClockinComponentDto> OnReportClicked { get; set; }

    private async Task ReportThisAsync()
    {
        if (OnReportClicked.HasDelegate)
            await OnReportClicked.InvokeAsync(Component);
    }
}