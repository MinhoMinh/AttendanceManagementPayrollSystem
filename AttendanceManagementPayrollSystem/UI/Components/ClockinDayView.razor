@using AttendanceManagementPayrollSystem.DTO
@using Blazorise

<style>
    .clockin-dayview-card {
        border: 2px solid #FFE4A1;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 3px 6px rgba(151, 50, 45, 0.15);
        transition: all 0.3s ease;
        background: #FFFBF5;
    }

        .clockin-dayview-card:hover {
            box-shadow: 0 5px 12px rgba(151, 50, 45, 0.25);
            transform: translateY(-2px);
        }

        .clockin-dayview-card .card-header {
            background: linear-gradient(135deg, #97322D, #7A2623);
            color: #FFE4A1;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-bottom: 2px solid #FFE4A1;
        }

        .clockin-dayview-card .card-body {
            padding: 1rem;
        }

        .clockin-dayview-card .field-label {
            color: #97322D;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .clockin-dayview-card .field-body {
            color: #5A5A5A;
            margin-bottom: 0.75rem;
        }

        .clockin-dayview-card .btn-report {
            background: linear-gradient(135deg, #FFE4A1, #FFD978);
            color: #97322D;
            border: 2px solid #97322D;
            font-weight: 600;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .clockin-dayview-card .btn-report:hover {
            background: linear-gradient(135deg, #97322D, #7A2623);
            color: #FFE4A1;
            border-color: #FFE4A1;
            transform: scale(1.05);
        }

        .clockin-dayview-card .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .clockin-dayview-card .badge-success {
            background: #90EE90;
            color: #2D5A2D;
            border: 1px solid #2D5A2D;
        }

        .clockin-dayview-card .badge-danger {
            background: #FFB6C1;
            color: #97322D;
            border: 1px solid #97322D;
        }

        .clockin-dayview-card .badge-secondary {
            background: #D3D3D3;
            color: #5A5A5A;
            border: 1px solid #5A5A5A;
        }

        .clockin-dayview-card .text-warning {
            color: #FFE4A1 !important;
            text-shadow: 0 0 2px #97322D;
        }

        .clockin-dayview-card .text-primary {
            color: #97322D !important;
        }

        .clockin-dayview-card .fw-bold {
            font-weight: 700;
        }

        .clockin-dayview-card pre {
            background: #FFF5DC;
            border: 1px solid #FFE4A1;
            border-radius: 6px;
            padding: 0.75rem;
            color: #5A5A5A;
            font-size: 0.85rem;
            max-height: 150px;
            overflow-y: auto;
        }

        .clockin-dayview-card .time-display {
            background: linear-gradient(90deg, #FFF5DC, transparent);
            border-left: 3px solid #97322D;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            display: inline-block;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #97322D;
        }
</style>

<Card Class="clockin-dayview-card mb-3">
    <CardHeader class="d-flex justify-content-between align-items-center">
        <strong>Ca làm</strong>
        <button class="btn btn-report" @onclick="ReportThisAsync">
            📋 Báo cáo
        </button>
    </CardHeader>
    <CardBody>
        <Field>
            <FieldLabel>Tình trạng</FieldLabel>
            <FieldBody>
                @if (!string.IsNullOrWhiteSpace(Component.Description))
                {
                    bool isFull = Component.Description.Trim() == "Đủ giờ";
                    <Badge Color="@(isFull? Color.Success: Color.Danger)" Class="@(isFull ? "badge-success" : "badge-danger")">
                        @Component.Description
                    </Badge>
                }
                else
                {
                    <Badge Color="Color.Secondary" Class="badge-secondary">Không có dữ liệu</Badge>
                }
            </FieldBody>
        </Field>
        <Field>
            <FieldLabel>Giờ làm</FieldLabel>
            <FieldBody>
                <strong>@($"{(Component.WorkHours ?? 0m):F2}/{(Component.ScheduledHours ?? 0m):F2}")</strong>
            </FieldBody>
        </Field>
        @if (Component.OverridedWorkunits is not null)
        {
            <Field>
                <FieldLabel>Công làm (đã điều chỉnh)</FieldLabel>
                <FieldBody>
                    <span>
                        <span class="fw-bold text-warning">
                            @($"{Component.OverridedWorkunits:F2}")
                        </span>
                        <span class="text-muted">
                            (@($"{(Component.WorkUnits ?? 0m):F2}"))
                        </span>
                        /@($"{(Component.ScheduledUnits ?? 0m):F2}")
                    </span>
                </FieldBody>
            </Field>
        }
        else
        {
            <Field>
                <FieldLabel>Công làm</FieldLabel>
                <FieldBody>
                    <span class="fw-bold text-primary">
                        @($"{(Component.WorkUnits ?? 0m):F2}/{(Component.ScheduledUnits ?? 0m):F2}")
                    </span>
                </FieldBody>
            </Field>
        }
        <Field>
            <FieldLabel>Giờ vào / Giờ ra</FieldLabel>
            <FieldBody>
                <div class="d-flex flex-row gap-3">
                    <span class="time-display">⏰ @(Component.CheckIn?.ToString("HH:mm") ?? "--:--")</span>
                    <span class="time-display">🚪 @(Component.CheckOut?.ToString("HH:mm") ?? "--:--")</span>
                </div>
            </FieldBody>
        </Field>
        <Field>
            <FieldLabel>Bảng ghi</FieldLabel>
            <FieldBody>
                @if (!string.IsNullOrWhiteSpace(Component.ClockinLog))
                {
                    <pre class="mb-0">@Component.ClockinLog</pre>
                }
                else
                {
                    <span class="text-muted">Không có dữ liệu</span>
                }
            </FieldBody>
        </Field>
    </CardBody>
</Card>

@code {
    [Parameter] public ClockinComponentDto Component { get; set; }
    [Parameter] public EventCallback<ClockinComponentDto> OnReportClicked { get; set; }

    private async Task ReportThisAsync()
    {
        if (OnReportClicked.HasDelegate)
            await OnReportClicked.InvokeAsync(Component);
    }
}